const { performance } = require('perf_hooks');
const run = () => {
    const startTime = performance.now()
    let final = 0;
    let data = input;

    const UP = "^";
    const DN = "v";
    const LT = "<";
    const RT = ">";

    const EMPTY = ".";
    const VISITED = "X";

    const OBSTACLE = "#";


    data = data.split("\n");

    data.forEach((line, index) => {
        data[index] = line.split("");
    });

    let j = 0, i = 0;
    const exists = search => {
        for(let p = 0; p < data.length; p++) {
            if(data[p].indexOf(search) != -1) {
                i = p;
                j = data[p].indexOf(search);
                return true;
            }
        }
        return false;
    };

    console.log("processing...")
    while(exists(UP) || exists(DN) || exists(LT) || exists(RT)) {

                if (data[i][j] == UP) {
                    let testStr = "Guard is at data[" + i + "][" + j + " ] facing UP. Above is: ";
                    if(i == 0) {
                        // console.log(testStr + " OFF MAP!");
                        data[i][j] = VISITED;
                    } else if (data[i-1][j] == EMPTY || data[i-1][j] == VISITED) {
                        // console.log(testStr + " WALKABLE. Going up!");
                        data[i][j] = VISITED;
                        data[i-1][j] = UP;
                    } else if (data[i-1][j] == OBSTACLE) {
                        // console.log(testStr + " BLOCKED. Rotating Right!");
                        data[i][j] = RT;
                    }
                } else if (data[i][j] == DN) {
                    let testStr = "Guard is at data[" + i + "][" + j + " ] facing DN. Below is: ";
                    if(i == data.length-1) { //IS THIS WRONG? JUST LENGTH?
                        // console.log(testStr + " OFF MAP!");
                        data[i][j] = VISITED;
                    } else if (data[i+1][j] == EMPTY || data[i+1][j] == VISITED) {
                        // console.log(testStr + " WALKABLE. Going dn!");
                        data[i][j] = VISITED;
                        data[i+1][j] = DN;
                    } else if (data[i+1][j] == OBSTACLE) {
                        // console.log(testStr + " BLOCKED. Rotating Right!");
                        data[i][j] = LT;
                    }
                } else if (data[i][j] == LT) {
                    let testStr = "Guard is at data[" + i + "][" + j + " ] facing LT. Left is: ";
                    if(j == 0) {
                        // console.log(testStr + " OFF MAP!");
                        data[i][j] = VISITED;
                    } else if (data[i][j-1] == EMPTY || data[i][j-1] == VISITED) {
                        // console.log(testStr + " WALKABLE. Going lt!");
                        data[i][j] = VISITED;
                        data[i][j-1] = LT;
                    } else if (data[i][j-1] == OBSTACLE) {
                        // console.log(testStr + " BLOCKED. Rotating Right!");
                        data[i][j] = UP;
                    }
                } else if (data[i][j] == RT) {
                    let testStr = "Guard is at data[" + i + "][" + j + " ] facing RT. Right is: ";
                    if(j == data[i].length-1) { //IS THIS WRONG? JUST LENGTH?
                        // console.log(testStr + " OFF MAP!");
                        data[i][j] = VISITED;
                    } else if (data[i][j+1] == EMPTY || data[i][j+1] == VISITED) {
                        // console.log(testStr + " WALKABLE. Going rt!");
                        data[i][j] = VISITED;
                        data[i][j+1] = RT;
                    } else if (data[i][j+1] == OBSTACLE) {
                        // console.log(testStr + " BLOCKED. Rotating Right!");
                        data[i][j] = DN;
                    }
                } 
    }


    for(let i = 0; i < data.length; i++) {
        for(let j = 0; j < data[i].length; j++) {
            if(data[i][j] == VISITED) final++;
        }
    }
    const endTime = performance.now()
    console.log("FINAL: " + final + " RUNTIME: " + (endTime - startTime) + " ms")//5095
}



const testin = `....#.....
.........#
..........
..#.......
.......#..
..........
.#..^.....
........#.
#.........
......#...`;

const input = `..#....##....................#...#...#..........................................................................................#.
.....#..............................................#....#.....#.....#..............................#.......#...#.............#...
............#.#.........................................#...................#..#...........................###..........#.....#...
.....#.....#.............#...........................................................#.#.................#.........#..............
.......................#...........................#................#...........#......#.....................#...#.......#....#...
...#........................................#....................#.......#........##.##.........#.........................#.......
......#...........#....................#...........#.............................#........................#....................#..
...........................#...................................#...............#.........................................#........
........#...........#................................................................#............#...............................
.........................#......#.......#..............#......#.................#..................#...................#..........
............#......................................................#..............................#........#....#.................
........#.....................................................................#..............#....................................
..#............................#.................#.#............#.................................................................
...#................#.....................#.................................................#...................#.................
......#...................#........................................................................................#..#...........
.....................##..#........................................#...................#............#.....#........................
.......#.................#..........#...........................#.......#..............#..........................................
.............#........#........#..........#................#.........#.##.................................#.......#...........#...
.#..............................................................#..#.....................................#.................##.....
.........................#.#.......#.#..................................................#....................#.......#.........#..
.............#................................................#..#................#.............#.....#...........................
.............................................#..............#.....#..............#.........#......................................
................#............#............................#...........#.#.........................................................
...#.................................#.......#.........................................#..........................................
...............................#.....................................................................#.....#.........##...........
...................#...................................#.....................#.............................#..#...#...............
......#.......................................................#............................#......#.................#.#...........
...........................................#........................#.........#........................##......#..................
....#.......................#...................#.....#....................#......................................................
.....#......#....#..........#............#........#...............................................................................
.........#.................................................................................#........#.........................#...
........................#................................#........#...#......#........#..........#.#.......#.........#.........#.#
.##......#..#......#............#.#.................................#..............................#.........#....................
......#..............................#..........#.........#.....#....................................#...........................#
..#.........................#.#...#............................................#.#.......................................##.......
#.........................#......................#.............#..#.#...#....#.....#.#...#......#........................#........
.#............................#.................................#....#..............................#........#..........#.........
..........#.........#.....#.....#......................#............................................#.............................
.........................#...#.............................#..............................................#......#.#..............
....................#................................................................................................#............
...#........#......................#..#...........#..#.........#.................................................#................
...................#....................#..............#......................#..............#........#......................#....
.............#..................................................................................#................#.....##.........
.#.............................#........#................#..#..#.....#...........###..............................................
.......................................................#.........................#.............................#..................
...........................##.............#.........................................................#.......................#.....
......#.......##.........#..................................................................#.#..#.........#.........#.......#....
..#...........#..........#........#....#..........#..................#.............#.............#................................
#................................##...........#......#....##......#..#.....................................#.........#..#.........
...#...#.#.......................#......................................#.........#......#...............#........................
..#...#.......................................................#..................#.........................................#......
...#.....#.....#..........#....................#..................#.........................#...............#...#..#....#.........
..........#................................#...................#..#...........#.........#....................................#....
..............#........#............................#..................................................................#........#.
............................................................#.....##.................................#............................
...##..............................................#..........................................#.............................#.##..
...#...........................................................................#......#.....................#.#...................
.........#.............................................................................##.....................................#.#.
...............#.....#........#..#................................................................................................
#...........................#.#..............................#........^......#.................................#.....#............
...#...#.........................................#......................#.#.......................................................
.#......#...........................#.............................................................................................
.....#.........#.......#..#........#.....#.....................#......#........................................#...#..............
....#....................................................................................................#........................
#..............#.......................#.........................................#...............................#.#..............
................................#..............................#.......................................................#....#.....
....#............................#............................................................#.....#........#...................#
...........#...#............................#....................#.......................................................#........
.#.....................................................................................................#.....#....................
.#.......#..............#.....................#.....................#............#........................#.......................
............................#...#................................................#................................#...............
..........#...............#..........................#................#.........................#.......#.#.......................
..............................#.............................................................................................#.....
..............................................#....#...............................................#.....#........................
.........#...................................................#...............#.....#................#.............................
...........................................#..............#....................................................#........#.#.......
..........................#...........#.#...#.....................................#......................#...........#..#.........
....#...............#..............#.............................#....#.....#....#................................................
....#.#...........#..............#.................................................................#..............................
.....#.......#..........................................................................................#.#.......................
................................................#..#..............................................................................
.#....#..............................#..........#................#.............................................................#..
....#.......................#........#.....#..............#...............#..#........................................#...........
...........................................................................#......................................................
...#.........#..#.......................................................#..#..............................#.......................
.............#...................................................................#.......................#...#...........#........
.....#........................#....................#...................#................................#.........................
.........#......#...........................................#.......#....................#........................................
...........................................................#...........................#.............................#............
..........................#..............#........................................#......#.........#.#.............#........#.....
.........#..............#..#...........................#......#.......................#..#..#.............#.......................
...#.................#...............................................................................................#............
................#.....#.#...........................#......................#....................................#...#.#...........
..................#.....#...............................................................#............................#....#..#....
...............................#................................................#.............#..........................#........
..#...........#................................................#.........................................#...............##......#
...............................#..................##..#...........................................#................#..............
...........................#........#.........#....................................................#......#......#................
..................................#................#..................#.....#..................#...................#.....#........
.......#...#................................................................##...........................................#........
..............#..#.......#............................#...................#....#...........................#..#......#............
...............#............#................................................................................#..............#.....
...............#.....#........................#.........#.........#...#................#....#.........#...........................
................................#........................................................................#.........#..............
.............#..................#...#................................#..............#................................#.........#..
.....................#.#.............................#......#..................................#.........##....#.................#
......#.........#...#.................................#..........#.#......................#.......#........#......................
.....#....................#......................#.........#.....................#.........................................#......
.........##.....................#....#.#....#....................................................................................#
.................................................#.#....#....................#...............##..#................................
..##.......#........#.......................#.....................................................................#...........#.##
..#...........##........##......#..........#....................#.....#.....#..................#.....#............................
..........................#.......................#.....#.........................................................................
.#...........................#..............#...#...........#.....#.......#....#............#.....#..................#....#......#
.................#.......................#....#...#..................#......#............................#.....................#..
.....##..#........#........................#......#........................#....#......................##.........................
...#....................................................................................................#.......................#.
.......................#...#..............#..................#............#.#.........#....#...#..................................
...........#.......................#.......................#.......#....#.....#..................#...................#............
..................#......................................................................#.......#..........................#.....
.......#..................#.............#..#........##........#..##........##.....##...#................#..#.......#..............
........#................#..............................#..#......................................................................
...................#....#.........................#...........#.#......##.........#.#..................#..#.#....#........#.......
.............#......#.....................................................#.......................................................
.........................#.......................#..................#.........................#...............................#..#
..#...........................#............#.................##...#................#.................#................#...........
.....#...............#.....#..........#..................................#.#........................#.....###.#...................
...............................................#.............#......................................................#.............
......#......................#..............#.................#.#........#.................#......................................
........................#.......................................#....................#.......#.#..#...............................`;

run();